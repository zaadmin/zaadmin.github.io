---
title: http1.X与http2.0
date: 2022-09-04 16:54:14
permalink: /pages/5826d5/
categories:
  - 网络
  - http1.X与http2.0
tags:
  - 网络
author: 
  name: ai.zhang
  link: https://github.com/zaadmin
---

## HTTP简介
HTTP协议是Hyper Text Transfer Protocol（超文本传输协议）的缩写,是用于从万维网（WWW:World Wide Web ）服务器传输超文本到本地浏览器的传送协议。
* HTTP是一个属于应用层的面向对象的协议,基于TCP/IP通信协议来传递数据（HTML 文件, 图片文件, 查询结果等）。
* HTTP协议工作于客户端-服务端架构为上。浏览器作为HTTP客户端通过URL向HTTP服务端即WEB服务器发送所有请求。Web服务器根据接收到的请求后，向客户端发送响应信息。
* 默认端口是 TCP 80，但也可以使用其他端口。

## HTTP基本功能
* HTTP 是无连接的
  浏览器发起 HTTP 请求，请求发出后，客户端断开与服务器的连接并等待响应。服务器处理请求并重新建立与客户端的连接以发回响应。
* HTTP 是独立于媒体的
  只要客户端和服务器都知道如何处理数据内容，任何类型的数据都可以通过 HTTP 发送。
* HTTP 是无状态的
  HTTP 是无连接的，这是 HTTP 是无状态协议的直接结果。服务器和客户端仅在当前请求期间才知道彼此。之后，两个人都忘记了对方。由于协议的这种性质，客户端和浏览器都不能保留跨网页的不同请求之间的信息。

## HTTP1.x与http2.0的区别
* HTTP1.0
- 服务器的每次请求，都要建立一次连接。完成请求后立即断开连接。
* HTTP1.1
- 引入持久连接：TCP连接默认不关闭，可以多个请求复用。
- 引入管道机制：在同一个TCP连接中，客户端可以同时发多个请求，服务端顺序执行。
- 依旧存在的问题：
1. 请求是按次序的，后来者需要排队等待。
2. 请求头大多类似，重复传输浪费资源。
3. 同一域名的浏览器有最大并行请求限制。
* HTTP1.x
HTTP 1.X 是基于文本的，因为是文本，就导致了它必须是个整体，在传输是不可切割的，只能整体去传。
* HTTP2.0
- 采用多路复用：在一个连接里，客户端和浏览器都可以同时发送多个请求或回应
- 进行了二进制分帧：传输的信息分割为更小的消息和帧，并对它们采用二进制格式的编码。
- Header压缩、服务端推送。

## HTTPS
- 使用HTTP通信，用SSL/TLS加密。
- HTTP和HTTPS是两个不同的协议
- HTTPS默认端口号：443

## HTTP2.0多路复用，及多路复用可能有什么问题
* 什么是多路复用
就是在一个 TCP 连接中可以存在多条流。换句话说，也就是可以发送多个请求，对端可以通过帧中的标识知道属于哪个请求。通过这个技术，可以避免 HTTP 旧版本中的队头阻塞问题，极大的提高传输性能。

* 多路复用的实现

- 同域名下所有通信都在单个连接上完成，同个域名只需要占用一个 TCP 连接，使用一个连接并行发送多个请求和响应。

- 单个连接可以承载任意数量的双向数据流，单个连接上可以并行交错的请求和响应，之间互不干扰。

- 数据流以消息的形式发送，而消息又由一个或多个帧组成，帧之间可以乱序发送（不同流的帧乱序发送，同一个流的帧顺序发送），因为根据帧首部的流标识可以在接收端重新组装。每个请求都可以带一个 31bit 的优先值，0 表示最高优先级， 数值越大优先级越低

* 多路复用可能存在问题
- TCP 的队头阻塞并没有彻底解决： TCP 为了保证可靠传输，有一个“超时重传”机制，丢失的包必须等待重传确认

- 多路复用导致服务器压力上升：多路复用没有限制同时请求数。请求的平均数量与往常相同，但实际会有许多请求的短暂爆发，导致瞬时 QPS 暴增

- 多路复用容易 Timeout： 大批量的请求同时发送，由于 HTTP2 连接内存在多个并行的流，而网络带宽和服务器资源有限，每个流的资源会被稀释，虽然它们开始时间相差更短，但却都可能超时。

## HTTP/1.1 不能实现“多路复用”
HTTP/2 是基于二进制“帧”的协议，HTTP/1.1 是基于“文本分割”解析的协议。

HTTP/1.1 发送请求消息的文本格式：以换行符分割每一条 key:value 的内容，解析这种数据用不着什么高科技，相反的，解析这种数据往往速度慢且容易出错。“服务端”需要不断的读入字节，直到遇到分隔符（这里指换行符，代码中可能使用/n 或者/r/n 表示）

一次只能处理一个请求或响应，因为这种以分隔符分割消息的数据，在完成之前不能停止解析
